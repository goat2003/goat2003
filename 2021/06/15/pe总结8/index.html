<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>PE文件笔记八 实战之HOOK程序添加弹窗 | z1inのblog</title><meta name="keywords" content="pe"><meta name="author" content="z1in"><meta name="copyright" content="z1in"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="前面学习了PE的结构后，尝试结合先前所学，修改PE文件来实现给程序添加弹窗的功能 PS：这篇笔记并没有怎么涉及PE的知识点，重点放在了HOOK、反汇编和硬编码上，对PE不是很了解也可以看看，涉及PE知识点的内容放在了后面的笔记：PE文件笔记九 实战之HOOK程序添加弹窗续，可以放心食用（￣︶￣）↗　 PE实战之给程序添加弹窗修改流程要给程序添加弹窗，首先就是要了解其修改的流程 首先要修改的便是程序">
<meta property="og:type" content="article">
<meta property="og:title" content="PE文件笔记八 实战之HOOK程序添加弹窗">
<meta property="og:url" content="http://example.com/2021/06/15/pe%E6%80%BB%E7%BB%938/index.html">
<meta property="og:site_name" content="z1inのblog">
<meta property="og:description" content="前面学习了PE的结构后，尝试结合先前所学，修改PE文件来实现给程序添加弹窗的功能 PS：这篇笔记并没有怎么涉及PE的知识点，重点放在了HOOK、反汇编和硬编码上，对PE不是很了解也可以看看，涉及PE知识点的内容放在了后面的笔记：PE文件笔记九 实战之HOOK程序添加弹窗续，可以放心食用（￣︶￣）↗　 PE实战之给程序添加弹窗修改流程要给程序添加弹窗，首先就是要了解其修改的流程 首先要修改的便是程序">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/images/004.jpg">
<meta property="article:published_time" content="2021-06-15T07:56:28.000Z">
<meta property="article:modified_time" content="2021-06-19T02:25:46.248Z">
<meta property="article:author" content="z1in">
<meta property="article:tag" content="pe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/004.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2021/06/15/pe%E6%80%BB%E7%BB%938/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: z1in","link":"链接: ","source":"来源: z1inのblog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"top-right"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'PE文件笔记八 实战之HOOK程序添加弹窗',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-06-19 10:25:46'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><link rel="stylesheet" href="/css/gundong.css"><link rel="stylesheet" href="/css/jianbian.css"><link rel="stylesheet" href="/css/touming.css"><link rel="stylesheet" href="/css/background.css"><link rel="stylesheet" href="/css/iconfont.css"><link rel="stylesheet" href="/css/shubiao.css"><link rel="stylesheet" href="/css/zhedie.css"><script src="/js/sakura.js"></script><!--在线聊天if theme.daovoice
  script(src=url_for(theme.CDN.daovoice) defer)
--><div class="aplayer" data-id="6686325036" data-server="netease" data-type="playlist" data-fixed="true" data-listFolded="false" data-order="random" data-preload="auto"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lete114/CDN/music/APlayer/APlayer.min.css"><script src="https://cdn.jsdelivr.net/gh/lete114/CDN/music/APlayer/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@1.2.0/dist/Meting.min.js"></script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="z1inのblog" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/loading.gif" data-original="/img/tit.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">36</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">8</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/artitalk/"><i class="fa-fw fa fa-comments"></i><span> 说说</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 伙伴</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/images/002.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">z1inのblog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/artitalk/"><i class="fa-fw fa fa-comments"></i><span> 说说</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 伙伴</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">PE文件笔记八 实战之HOOK程序添加弹窗</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-06-15T07:56:28.000Z" title="发表于 2021-06-15 15:56:28">2021-06-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-06-19T02:25:46.248Z" title="更新于 2021-06-19 10:25:46">2021-06-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/pe/">pe</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="PE文件笔记八 实战之HOOK程序添加弹窗"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>前面学习了PE的结构后，尝试结合先前所学，修改PE文件来实现给程序添加弹窗的功能</p>
<p>PS：这篇笔记并<strong>没有怎么涉及PE的知识点</strong>，重点放在了<strong>HOOK、反汇编和硬编码</strong>上，对PE不是很了解也可以看看，涉及PE知识点的内容放在了后面的笔记：<a target="_blank" rel="noopener" href="https://www.52pojie.cn/thread-1409183-1-1.html">PE文件笔记九 实战之HOOK程序添加弹窗续</a>，可以放心食用（￣︶￣）↗　</p>
<h1 id="PE实战之给程序添加弹窗"><a href="#PE实战之给程序添加弹窗" class="headerlink" title="PE实战之给程序添加弹窗"></a>PE实战之给程序添加弹窗</h1><h2 id="修改流程"><a href="#修改流程" class="headerlink" title="修改流程"></a>修改流程</h2><p>要给程序添加弹窗，首先就是要了解其修改的流程</p>
<p>首先要修改的便是程序原本的入口地址，将其修改为弹窗代码所在的地址</p>
<p>弹窗代码所在的地址，要在PE文件中找到一片区域，该区域需要 满足 可执行、可读、可写的权限，然后在这片区域写入弹窗代码，弹窗代码的最后要<strong>跳转回</strong>原本的入口地址</p>
<hr>
<p>该修改流程是一种十分经典的HOOK思想，即程序按照原本的流程执行着，你把它原本执行的代码修改了，修改去干我们想要做的事情，做完我们想要的事情后再把它放回去继续执行原本的代码</p>
<hr>
<h2 id="图解HOOK修改流程"><a href="#图解HOOK修改流程" class="headerlink" title="图解HOOK修改流程"></a>图解HOOK修改流程</h2><p><img src="/img/loading.gif" data-original="https://610-pic-bed.oss-cn-shenzhen.aliyuncs.com/image-20210403010059279.png" alt="image-20210403010059279"></p>
<p>被HOOK的地方为B</p>
<p>正常流程 A→B→C</p>
<p>HOOK流程 A→被HOOK的B→自己的代码→复原B中被修改的部分→跳转回B原本要接着执行的地方→C</p>
<hr>
<h2 id="图解给程序添加弹窗"><a href="#图解给程序添加弹窗" class="headerlink" title="图解给程序添加弹窗"></a>图解给程序添加弹窗</h2><p><img src="/img/loading.gif" data-original="https://610-pic-bed.oss-cn-shenzhen.aliyuncs.com/image-20210403010119501.png" alt="image-20210403010119501"></p>
<hr>
<h2 id="弹窗代码"><a href="#弹窗代码" class="headerlink" title="弹窗代码"></a>弹窗代码</h2><p>既然要给程序添加弹窗，自然需要知道如何通过代码显示一个简单的弹窗</p>
<p>下面给出一个简单的弹窗代码</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"> 复制代码 隐藏代码#include &lt;Windows.h&gt;</span><br><span class="line">int main() &#123;</span><br><span class="line">    //调用MessageBoxA函数</span><br><span class="line">    //显示一个 没有所有者窗口的、内容为lyl610abc的、标题为tips的、只包含一个按钮:OK的 窗口</span><br><span class="line">    MessageBoxA(0, &quot;lyl610abc&quot;, &quot;tips&quot;, 0);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h2><p><img src="/img/loading.gif" data-original="https://610-pic-bed.oss-cn-shenzhen.aliyuncs.com/image-20210402190334225.png" alt="image-20210402190334225"></p>
<hr>
<h2 id="MessageBoxA"><a href="#MessageBoxA" class="headerlink" title="MessageBoxA"></a>MessageBoxA</h2><p>下面为介绍MessageBoxA的使用文档，<strong>熟悉MessageBoxA的可以跳过</strong>，直接跳到后面的<strong>查看反汇编</strong>即可</p>
<h3 id="函数原型"><a href="#函数原型" class="headerlink" title="函数原型"></a>函数原型</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"> 复制代码 隐藏代码int MessageBoxA(</span><br><span class="line">  HWND   hWnd,</span><br><span class="line">  LPCSTR lpText,</span><br><span class="line">  LPCSTR lpCaption,</span><br><span class="line">  UINT   uType</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">参数类型</th>
<th align="left">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="left">hWnd</td>
<td align="left">HWND(int)</td>
<td align="left">要创建的消息框的所有者窗口的句柄。如果该参数为空，则消息框没有所有者窗口</td>
</tr>
<tr>
<td align="left">lpText</td>
<td align="left">LPCSTR(CONST CHAR *)</td>
<td align="left">要显示的消息。如果字符串包含多行，可以在每行之间使用回车符和/或换行符来分隔行</td>
</tr>
<tr>
<td align="left">lpCaption</td>
<td align="left">LPCSTR(CONST CHAR *)</td>
<td align="left">对话框的标题。如果该参数为空，则默认标题为Error</td>
</tr>
<tr>
<td align="left">uType</td>
<td align="left">UINT(unsigned int)</td>
<td align="left">对话框的内容和行为</td>
</tr>
</tbody></table>
<h4 id="uType"><a href="#uType" class="headerlink" title="uType"></a>uType</h4><p>对话框的内容和行为。该参数可以是下列标志组中的标志的<strong>组合</strong></p>
<p>要指示消息框中显示的按钮，请指定以下值之一：</p>
<table>
<thead>
<tr>
<th align="left">宏定义</th>
<th align="left">值</th>
<th align="left">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="left">MB_ABORTRETRYIGNORE</td>
<td align="left">0x00000002L</td>
<td align="left">消息框包含三个按钮:中止、重试和忽略</td>
</tr>
<tr>
<td align="left">MB_CANCELTRYCONTINUE</td>
<td align="left">0x00000006L</td>
<td align="left">消息框包含三个按钮:取消、重试、继续。使用此消息框类型而不是MB_ABORTRETRYIGNORE</td>
</tr>
<tr>
<td align="left">MB_HELP</td>
<td align="left">0x00004000L</td>
<td align="left">将“帮助”按钮添加到消息框。当用户单击帮助按钮或按下F1时，系统将向所有者发送一条WM_HELP消息</td>
</tr>
<tr>
<td align="left">MB_OK</td>
<td align="left">0x00000000L</td>
<td align="left">消息框包含一个按钮:OK。这是默认值</td>
</tr>
<tr>
<td align="left">MB_OKCANCEL</td>
<td align="left">0x00000001L</td>
<td align="left">消息框包含两个按钮:OK和Cancel</td>
</tr>
<tr>
<td align="left">MB_RETRYCANCEL</td>
<td align="left">0x00000005L</td>
<td align="left">消息框包含两个按钮:重试和取消</td>
</tr>
<tr>
<td align="left">MB_YESNO</td>
<td align="left">0x00000004L</td>
<td align="left">消息框包含两个按钮:Yes和No</td>
</tr>
<tr>
<td align="left">MB_YESNOCANCEL</td>
<td align="left">0x00000003L</td>
<td align="left">T消息框包含三个按钮:Yes、No和Cancel</td>
</tr>
</tbody></table>
<hr>
<p>要在消息框中显示图标，请指定以下值之一：</p>
<table>
<thead>
<tr>
<th align="left">宏定义</th>
<th align="left">值</th>
<th align="left">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="left">MB_ICONEXCLAMATION</td>
<td align="left">0x00000030L</td>
<td align="left">消息框中会出现一个感叹号图标</td>
</tr>
<tr>
<td align="left">MB_ICONWARNING</td>
<td align="left">0x00000030L</td>
<td align="left">消息框中会出现一个感叹号图标</td>
</tr>
<tr>
<td align="left">MB_ICONINFORMATION</td>
<td align="left">0x00000040L</td>
<td align="left">消息框中会出现一个由小写字母i组成的圆圈图标</td>
</tr>
<tr>
<td align="left">MB_ICONASTERISK</td>
<td align="left">0x00000040L</td>
<td align="left">消息框中会出现一个由小写字母i组成的圆圈图标</td>
</tr>
<tr>
<td align="left">MB_ICONQUESTION</td>
<td align="left">0x00000020L</td>
<td align="left">一个问号图标出现在消息框中。不再推荐使用问号消息图标，因为它不能清楚地表示特定类型的消息，而且将消息表述为问题可以应用于任何类型的消息。此外，用户可能会将消息符号问号与帮助信息混淆。因此，不要在您的消息框中使用这个问号消息符号。系统继续支持它，只是为了向旧版本兼容</td>
</tr>
<tr>
<td align="left">MB_ICONSTOP</td>
<td align="left">0x00000010L</td>
<td align="left">消息框中出现停止标志图标</td>
</tr>
<tr>
<td align="left">MB_ICONERROR</td>
<td align="left">0x00000010L</td>
<td align="left">消息框中出现停止标志图标</td>
</tr>
<tr>
<td align="left">MB_ICONHAND</td>
<td align="left">0x00000010L</td>
<td align="left">消息框中出现停止标志图标</td>
</tr>
</tbody></table>
<hr>
<p>要指定默认按钮，请指定以下值之一：</p>
<table>
<thead>
<tr>
<th align="left">宏定义</th>
<th align="left">值</th>
<th align="left">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="left">MB_DEFBUTTON1</td>
<td align="left">0x00000000L</td>
<td align="left">第一个按钮是默认按钮。 除非指定了MB_DEFBUTTON2、MB_DEFBUTTON3或MB_DEFBUTTON4，否则MB_DEFBUTTON1是默认值</td>
</tr>
<tr>
<td align="left">MB_DEFBUTTON2</td>
<td align="left">0x00000100L</td>
<td align="left">第二个按钮是默认按钮</td>
</tr>
<tr>
<td align="left">MB_DEFBUTTON3</td>
<td align="left">0x00000200L</td>
<td align="left">第三个按钮是默认按钮.</td>
</tr>
<tr>
<td align="left">MB_DEFBUTTON4</td>
<td align="left">0x00000300L</td>
<td align="left">第四个按钮是默认按钮</td>
</tr>
</tbody></table>
<hr>
<p>若要指示对话框的模式，请指定以下值之一：</p>
<table>
<thead>
<tr>
<th align="left">宏定义</th>
<th align="left">值</th>
<th align="left">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="left">MB_APPLMODAL</td>
<td align="left">0x00000000L</td>
<td align="left">用户必须响应消息框，然后才能在hWnd参数标识的窗口中继续工作。然而，用户可以移动到其他线程的窗口并在这些窗口中工作。 根据应用程序中窗口的层次结构，用户可以移动到线程中的其他窗口。消息框父窗口的所有子窗口都会被自动禁用，但弹出窗口不会。 如果没有指定MB_SYSTEMMODAL或MB_TASKMODAL，则MB_APPLMODAL是默认值</td>
</tr>
<tr>
<td align="left">MB_SYSTEMMODAL</td>
<td align="left">0x00001000L</td>
<td align="left">与MB_APPLMODAL相同，只是消息框具有WS_EX_TOPMOST样式。使用系统模式消息框来通知用户需要立即注意的严重的、潜在的破坏性错误(例如，内存耗尽)。这个标志对用户与windows交互的能力没有影响，除了那些与hWnd相关的</td>
</tr>
<tr>
<td align="left">MB_TASKMODAL</td>
<td align="left">0x00002000L</td>
<td align="left">与MB_APPLMODAL相同，只是当hWnd参数为NULL时，属于当前线程的所有顶级窗口都被禁用。当调用应用程序或库没有可用的窗口句柄，但仍然需要防止输入到调用线程中的其他窗口而不挂起其他线程时，使用此标志</td>
</tr>
</tbody></table>
<hr>
<p>要指定其他选项，请使用下列一个或多个值：</p>
<table>
<thead>
<tr>
<th align="left">宏定义</th>
<th align="left">值</th>
<th align="left">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="left">MB_DEFAULT_DESKTOP_ONLY</td>
<td align="left">0x00020000L</td>
<td align="left">与交互式窗口站的桌面相同。有关更多信息，请参见<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/desktop/winstation/window-stations">Window Stations</a>. 如果当前输入的桌面不是默认桌面，MessageBox直到用户切换到默认桌面才会返回。</td>
</tr>
<tr>
<td align="left">MB_RIGHT</td>
<td align="left">0x00080000L</td>
<td align="left">文本是右对齐的</td>
</tr>
<tr>
<td align="left">MB_RTLREADING</td>
<td align="left">0x00100000L</td>
<td align="left">在希伯来语和阿拉伯语系统上使用从右到左的阅读顺序显示消息和标题文本</td>
</tr>
<tr>
<td align="left">MB_SETFOREGROUND</td>
<td align="left">0x00010000L</td>
<td align="left">消息框成为前台窗口。在内部，系统为消息框调用<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/desktop/api/winuser/nf-winuser-setforegroundwindow">SetForegroundWindow</a>函数</td>
</tr>
<tr>
<td align="left">MB_TOPMOST</td>
<td align="left">0x00040000L</td>
<td align="left">消息框使用WS_EX_TOPMOST窗口样式创建</td>
</tr>
<tr>
<td align="left">MB_SERVICE_NOTIFICATION</td>
<td align="left">0x00200000L</td>
<td align="left">调用者是一个通知用户事件的服务。即使没有用户登录到计算机，该功能也会在当前活动桌面上显示一个消息框。 终端服务:如果调用线程有一个模拟令牌，该函数将消息框定向到模拟令牌中指定的会话。 如果设置此标志，则hWnd参数必须为空。这样可以在hWnd对应的其他桌面上显示该消息框。 有关使用此标志的安全注意事项的信息，请参见<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/desktop/Services/interactive-services">Interactive Services</a>。特别要注意的是，这个标志可以在锁定的桌面上生成交互式内容，因此应该只用于非常有限的场景，比如资源耗尽。</td>
</tr>
</tbody></table>
<h3 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h3><p>返回值类型：int</p>
<ul>
<li><p>如果消息框有一个取消按钮，如果ESC键被按下或取消按钮被选中，该函数将返回IDCANCEL值。如果消息框没有取消按钮，按ESC将没有效果-除非MB_OK按钮存在。如果出现MB_OK按钮，按“ESC”键，返回值为“IDOK”。</p>
</li>
<li><p>如果函数失败，返回值为0。要获取扩展的错误信息，请调用 <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror">GetLastError</a></p>
</li>
<li><p>如果函数成功，返回值是下面的菜单项值之一:</p>
<table>
<thead>
<tr>
<th align="left">返回码</th>
<th align="left">值</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">IDABORT</td>
<td align="left">3</td>
<td align="left">Abort按钮被选中</td>
</tr>
<tr>
<td align="left">IDCANCEL</td>
<td align="left">2</td>
<td align="left">Cancel按钮被选中</td>
</tr>
<tr>
<td align="left">IDCONTINUE</td>
<td align="left">11</td>
<td align="left">Continue按钮被选中</td>
</tr>
<tr>
<td align="left">IDIGNORE</td>
<td align="left">5</td>
<td align="left">Ignore按钮被选中</td>
</tr>
<tr>
<td align="left">IDNO</td>
<td align="left">7</td>
<td align="left">No按钮被选中</td>
</tr>
<tr>
<td align="left">IDOK</td>
<td align="left">1</td>
<td align="left">OK按钮被选中</td>
</tr>
<tr>
<td align="left">IDRETRY</td>
<td align="left">4</td>
<td align="left">Retry按钮被选中</td>
</tr>
<tr>
<td align="left">IDTRYAGAIN</td>
<td align="left">10</td>
<td align="left">Try Again按钮被选中</td>
</tr>
<tr>
<td align="left">IDYES</td>
<td align="left">6</td>
<td align="left">Yes按钮被选中</td>
</tr>
</tbody></table>
</li>
</ul>
<hr>
<p>通过将uType参数设置为对应的标志值，可以在消息框中使用以下系统图标</p>
<table>
<thead>
<tr>
<th align="left">图标</th>
<th align="left">Flag 值</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><img src="/img/loading.gif" data-original="https://docs.microsoft.com/en-us/windows/win32/api/winuser/images/mb_iconhand.png" alt="Icon for MB_ICONHAND, MB_ICONSTOP, and MB_ICONERROR"></td>
<td align="left"><strong>MB_ICONHAND</strong>, <strong>MB_ICONSTOP</strong>, 或 <strong>MB_ICONERROR</strong></td>
</tr>
<tr>
<td align="left"><img src="/img/loading.gif" data-original="https://docs.microsoft.com/en-us/windows/win32/api/winuser/images/mb_iconquestion.png" alt="Icon for MB_ICONQUESTION"></td>
<td align="left"><strong>MB_ICONQUESTION</strong></td>
</tr>
<tr>
<td align="left"><img src="/img/loading.gif" data-original="https://docs.microsoft.com/en-us/windows/win32/api/winuser/images/mb_iconexclamation.png" alt="Icon for MB_ICONEXCLAMATION and MB_ICONWARNING"></td>
<td align="left"><strong>MB_ICONEXCLAMATION</strong> 或 <strong>MB_ICONWARNING</strong></td>
</tr>
<tr>
<td align="left"><img src="/img/loading.gif" data-original="https://docs.microsoft.com/en-us/windows/win32/api/winuser/images/mb_iconasterisk.png" alt="Icon for MB_ICONASTERISK and MB_ICONINFORMATION"></td>
<td align="left"><strong>MB_ICONASTERISK</strong> 或 <strong>MB_ICONINFORMATION</strong></td>
</tr>
</tbody></table>
<hr>
<h2 id="查看反汇编"><a href="#查看反汇编" class="headerlink" title="查看反汇编"></a>查看反汇编</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"> 复制代码 隐藏代码9:        MessageBoxA(0,&quot;lyl610abc&quot;,&quot;tips&quot;,0);</span><br><span class="line">00401028 8B F4                mov         esi,esp</span><br><span class="line">0040102A 6A 00                push        0</span><br><span class="line">0040102C 68 28 20 42 00       push        offset string &quot;tips&quot; (00422028)</span><br><span class="line">00401031 68 1C 20 42 00       push        offset string &quot;lyl610abc&quot; (0042201c)</span><br><span class="line">00401036 6A 00                push        0</span><br><span class="line">00401038 FF 15 AC A2 42 00    call        dword ptr [__imp__MessageBoxA@16 (0042a2ac)]</span><br><span class="line">0040103E 3B F4                cmp         esi,esp</span><br><span class="line">00401040 E8 2B 00 00 00       call        __chkesp (00401070)</span><br></pre></td></tr></table></figure>

<hr>
<p>这里截取出关键的代码</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"> 复制代码 隐藏代码0040102A 6A 00                push        0</span><br><span class="line">0040102C 68 28 20 42 00       push        offset string &quot;tips&quot; (00422028)</span><br><span class="line">00401031 68 1C 20 42 00       push        offset string &quot;lyl610abc&quot; (0042201c)</span><br><span class="line">00401036 6A 00                push        0</span><br><span class="line">00401038 FF 15 AC A2 42 00    call        dword ptr [__imp__MessageBoxA@16 (0042a2ac)]</span><br></pre></td></tr></table></figure>

<hr>
<p>其余代码说明</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"> 复制代码 隐藏代码00401028 8B F4                mov         esi,esp                //保存执行前的esp(栈顶)到esi</span><br><span class="line">0040103E 3B F4                cmp         esi,esp                //比较esi和执行完call后的esp(栈顶)</span><br><span class="line">00401040 E8 2B 00 00 00       call        __chkesp (00401070)        //调用检测esp的函数</span><br></pre></td></tr></table></figure>

<p>用来检测，调用完函数后堆栈是否保持平衡，是C语言自动生成的，这里无需关注</p>
<hr>
<h2 id="解析反汇编"><a href="#解析反汇编" class="headerlink" title="解析反汇编"></a>解析反汇编</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"> 复制代码 隐藏代码0040102A 6A 00                push        0</span><br><span class="line">0040102C 68 28 20 42 00       push        offset string &quot;tips&quot; (00422028)</span><br><span class="line">00401031 68 1C 20 42 00       push        offset string &quot;lyl610abc&quot; (0042201c)</span><br><span class="line">00401036 6A 00                push        0</span><br></pre></td></tr></table></figure>

<p>前四行代码是依次压入四个参数（从右到左压入），这和调用协定相关，在<a target="_blank" rel="noopener" href="https://www.52pojie.cn/thread-1380788-1-1.html">逆向基础笔记九 C语言内联汇编和调用协定</a>已说过，这里不再赘述</p>
<hr>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"> 复制代码 隐藏代码</span><br><span class="line">00401038 FF 15 AC A2 42 00    call        dword ptr [__imp__MessageBoxA@16 (0042a2ac)]</span><br></pre></td></tr></table></figure>

<p>调用call这里，可以看到这是一个间接调用，形式为call [地址]，所以这里要查看一下其实际地址里存储的内容是什么，也就是其实际call的地址</p>
<p>通过内存窗口可以得到，其实际call的地址为77D507EA</p>
<p><img src="/img/loading.gif" data-original="https://610-pic-bed.oss-cn-shenzhen.aliyuncs.com/image-20210402192114225.png" alt="image-20210402192114225"></p>
<hr>
<p>所以此时的代码相当于</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"> 复制代码 隐藏代码</span><br><span class="line">00401038        call        77D507EA</span><br></pre></td></tr></table></figure>

<hr>
<p>这里为什么是一个间接call，77D507EA代表什么？</p>
<p>这里<strong>采用间接call的原因是引用了导入表</strong>，关于导入表和导出表的内容之后的笔记会再做说明</p>
<p>这里的77D507EA<strong>代表的是MessageBoxA函数的地址</strong></p>
<p>每个电脑的MessageBoxA函数的地址<strong>不一定相同</strong>，它取决于系统的user32.dll中导出表中给出的地址（这里调用的MessageBoxA是由user32.dll提供的）</p>
<p>可以用IDA来验证这一点：</p>
<p>找到系统中的user32.dll（在32位的xp中在C:\WINDOWS\system32下，在64位系统中则有2个，一个在C:\Windows\SysWOW64下(32位的dll)，一个也在C:\WINDOWS\system32下(64位的dll)，<strong>具体使用哪个取决于程序是32位还是64位</strong>）</p>
<p><img src="/img/loading.gif" data-original="https://610-pic-bed.oss-cn-shenzhen.aliyuncs.com/image-20210402193359108.png" alt="image-20210402193359108"></p>
<hr>
<p>将其用IDA打开，找到导出表，然后在导出表中搜索得到MessageBoxA</p>
<p><img src="/img/loading.gif" data-original="https://610-pic-bed.oss-cn-shenzhen.aliyuncs.com/image-20210402193459557.png" alt="image-20210402193459557"></p>
<p>可以看到它的地址和前面得到的一致，为77D507EA，验证来源完毕</p>
<p><strong>注意此时的系统是XP32位</strong>，在其它高版本的系统中这里的Address<strong>并不一定能和前面的一致</strong>，这里主要是为了说明<strong>函数的来源与导入表和导出表有关</strong>，也说明了<strong>为何不同系统的MessageBoxA的地址不一定相同</strong>，为后面的学习作个铺垫</p>
<hr>
<p><strong>准确得到函数地址的方法为</strong>：</p>
<p>如果想要得到MessageBoxA函数的（其它函数同理）地址，首先要找到一个有调用这个函数所属的模块的程序（MessageBoxA所属的模块为user32.dll），使用OD附加来查找：</p>
<p>一般来说只要是图形化的程序都会调用user32.dll这个模块，于是这里就随便拿一个exe程序就行，这里以dbgview.exe为例</p>
<p>使用OD打开dbgview.exe，然后单击图中所指的e，或者使用快捷键Alt+E</p>
<p><img src="/img/loading.gif" data-original="https://610-pic-bed.oss-cn-shenzhen.aliyuncs.com/image-20210402202400705.png" alt="image-20210402202400705"></p>
<hr>
<p>在弹出来的窗口中找到user32.dll，双击</p>
<p><img src="/img/loading.gif" data-original="https://610-pic-bed.oss-cn-shenzhen.aliyuncs.com/image-20210402202544557.png" alt="image-20210402202544557"></p>
<hr>
<p>在弹出来的反汇编界面按快捷键 Ctrl+N</p>
<p><img src="/img/loading.gif" data-original="https://610-pic-bed.oss-cn-shenzhen.aliyuncs.com/image-20210402202741746.png" alt="image-20210402202741746"></p>
<hr>
<p>然后在新窗口找到MessageBoxA对应的地址即可</p>
<p><img src="/img/loading.gif" data-original="https://610-pic-bed.oss-cn-shenzhen.aliyuncs.com/image-20210402202903145.png" alt="image-20210402202903145"></p>
<p>此时得到的地址就是准确的MessageBoxA地址了</p>
<hr>
<h2 id="自写反汇编测试"><a href="#自写反汇编测试" class="headerlink" title="自写反汇编测试"></a>自写反汇编测试</h2><h3 id="测试代码"><a href="#测试代码" class="headerlink" title="测试代码"></a>测试代码</h3><p>既然得到了MessageBoxA的函数地址，就无需间接调用了，可以直接调用它，于是自写代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"> 复制代码 隐藏代码#include&lt;stdio.h&gt;</span><br><span class="line">#include &lt;windows.h&gt;</span><br><span class="line">int MyMessageBoxA(HWND hWnd, LPCSTR lpText, LPCSTR lpCaption, UINT uType) &#123;</span><br><span class="line">        int ret;</span><br><span class="line">    //这里的地址填前面通过OD得到的MessageBoxA地址,每个系统不一定相同</span><br><span class="line">    //先前是在xp系统中测试的，那时的MessageBoxA为77D507EA</span><br><span class="line">    //此时换到WIN10 X64 测试，修改MessageBoxA的值</span><br><span class="line">        int addr = 0x76a3ee90;</span><br><span class="line">        __asm &#123;</span><br><span class="line">                push hWnd                </span><br><span class="line">                push lpCaption</span><br><span class="line">        push lpText</span><br><span class="line">                push uType</span><br><span class="line">                call addr</span><br><span class="line">                mov ret, eax</span><br><span class="line">        &#125;</span><br><span class="line">        return ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(int argc, char* argv[])</span><br><span class="line">&#123;</span><br><span class="line">        MyMessageBoxA(0, &quot;lyl610abc&quot;, &quot;tips&quot;, 0);</span><br><span class="line">        return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="测试结果"><a href="#测试结果" class="headerlink" title="测试结果"></a>测试结果</h3><h3 id><a href="#" class="headerlink" title></a><img src="/img/loading.gif" data-original="https://610-pic-bed.oss-cn-shenzhen.aliyuncs.com/image-20210402203720618.png" alt="image-20210402203720618"></h3><p>依然能够正常弹窗，测试成功</p>
<hr>
<h2 id="反汇编转为硬编码-字节码"><a href="#反汇编转为硬编码-字节码" class="headerlink" title="反汇编转为硬编码(字节码)"></a>反汇编转为硬编码(字节码)</h2><p>通过先前的学习可以知道在计算机中，无论是执行的代码还是数据都是以二进制来存储的，为了方便查看，进制查看工具将内容以十六进制的方式展示</p>
<p>所以为了给程序添加弹窗，显然就不是直接将反汇编写入PE文件中，而是<strong>要将反汇编对应的硬编码(字节码)写入到PE文件中</strong></p>
<p>如何将反汇编转化为硬编码？这个是<strong>反汇编引擎</strong>所做的事，在OD或VC中的反汇编引擎已经将反汇编对应的硬编码(字节码)给出了</p>
<p>有关反汇编引擎的内容也属于硬编码相关的知识，<strong>看以后要不要开这个坑</strong></p>
<p>将前面写的反汇编再稍作修改，将参数写死，并且去掉返回值的接收</p>
<h3 id="修改反汇编代码"><a href="#修改反汇编代码" class="headerlink" title="修改反汇编代码"></a>修改反汇编代码</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"> 复制代码 隐藏代码#include&lt;stdio.h&gt;</span><br><span class="line">#include &lt;windows.h&gt;</span><br><span class="line">void MyMessageBoxA() &#123;</span><br><span class="line">    //获取MessageBoxA的地址</span><br><span class="line">        int addr = (int)&amp;MessageBoxA;</span><br><span class="line">        printf(&quot;addr:%X\n&quot;, addr);</span><br><span class="line">    //&quot;lyl610abc&quot;对应的ASCII编码 6c 79 6c 36 31 30 61 62 63</span><br><span class="line">        unsigned char bytes[] = &#123; 0x6c,0x79,0x6c,0x36,0x31,0x30,0x61,0x62,0x63,0x00 &#125;;</span><br><span class="line">    //&quot;tips&quot;对应的ASCII编码</span><br><span class="line">        unsigned char bytes2[] = &#123; 0x74,0x69,0x70,0x73 &#125;;</span><br><span class="line">        //申请内存，该内存的属性为可执行 可读可写</span><br><span class="line">        LPVOID _lpText = VirtualAlloc(NULL, sizeof(byte), MEM_COMMIT, PAGE_EXECUTE_READWRITE);</span><br><span class="line">        //申请内存，该内存的属性为可执行 可读可写</span><br><span class="line">        LPVOID _lpCaption = VirtualAlloc(NULL, sizeof(byte), MEM_COMMIT, PAGE_EXECUTE_READWRITE);</span><br><span class="line">        //将硬编码写入申请的有权限的内存中</span><br><span class="line">        WriteProcessMemory(INVALID_HANDLE_VALUE, (LPVOID)_lpText, (BYTE*)bytes, sizeof(bytes), 0);</span><br><span class="line">        //将硬编码写入申请的有权限的内存中</span><br><span class="line">        WriteProcessMemory(INVALID_HANDLE_VALUE, (LPVOID)_lpCaption, (BYTE*)bytes2, sizeof(bytes2), 0);</span><br><span class="line">        __asm &#123;</span><br><span class="line">                push 0</span><br><span class="line">                push _lpCaption</span><br><span class="line">                push _lpText</span><br><span class="line">                push 0</span><br><span class="line">                call addr</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(int argc, char* argv[])</span><br><span class="line">&#123;</span><br><span class="line">        MyMessageBoxA();</span><br><span class="line">        return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="OD模拟代码操作"><a href="#OD模拟代码操作" class="headerlink" title="OD模拟代码操作"></a>OD模拟代码操作</h3><p><strong>先总结一下上面修改后的反汇编代码做了什么</strong></p>
<ol>
<li>获得MessageBoxA的函数地址</li>
<li>将字符串对应的ASCII码写入到<strong>可读可写</strong>的一片内存中</li>
<li>压入参数</li>
<li>调用MessageBoxA函数</li>
<li>调用完后跳转回原本要执行的代码</li>
</ol>
<hr>
<p><strong>然后在OD中复现操作</strong></p>
<p>用OD随便载入一个<strong>包含user32.dll模块</strong>的程序，我这里直接拿前面的代码编译后的程序来作演示</p>
<p><img src="/img/loading.gif" data-original="https://610-pic-bed.oss-cn-shenzhen.aliyuncs.com/image-20210402232452491.png" alt="image-20210402232452491"></p>
<hr>
<p>按照前面总结的步骤来</p>
<p><strong>1.MessageBoxA在OD中的地址是已知的无需获取</strong></p>
<hr>
<p><strong>2.将字符串对应的ASCII码写入到可读可写的一片内存中</strong></p>
<p>首先是选取一块可读可写的内存，很显然，接下来要执行的代码一定是可读可写可执行的，于是这里就无须申请内存了，直接将下面的代码覆盖即可</p>
<p>解决了选取内存的问题，接下来就是将字符串对应的ASCII码写入内存即可，但这要放在压入参数之后，原因后面会说明，现在先看压入参数</p>
<hr>
<p><strong>3.压入参数</strong></p>
<p>第一个参数为0，直接将其对应的反汇编修改为push 0即可</p>
<p><img src="/img/loading.gif" data-original="https://610-pic-bed.oss-cn-shenzhen.aliyuncs.com/image-20210402233328019.png" alt="image-20210402233328019"></p>
<hr>
<p>第二个参数为_lpCaption，要写入的字符串为”tips”，但此时字符串还没写入内存，也就是并不确定字符串的内存地址，但可以确定一个大致的范围，要存放字符串的地方就在下方不远处，于是这里可以暂时先填写离这里不远的随便一个内存地址<strong>用来占位，等之后确定了字符串的内存地址后再回来修改</strong></p>
<p>这里就随便选取下面的地址00401156</p>
<p>于是将反汇编修改为push 0x00401156</p>
<p><img src="/img/loading.gif" data-original="https://610-pic-bed.oss-cn-shenzhen.aliyuncs.com/image-20210402233751226.png" alt="image-20210402233751226"></p>
<hr>
<p>第三个参数为_lpText，要写入的字符串为”lyl610abc”，和前面的_lpCaption一样，先填入push xxxx占位，之后再回来修改</p>
<p>于是依旧将其反汇编修改为push 0x00401156</p>
<p><img src="/img/loading.gif" data-original="https://610-pic-bed.oss-cn-shenzhen.aliyuncs.com/image-20210402234015934.png" alt="image-20210402234015934"></p>
<hr>
<p>第四个参数为0，直接将其对应的反汇编修改为push 0即可</p>
<p><img src="/img/loading.gif" data-original="https://610-pic-bed.oss-cn-shenzhen.aliyuncs.com/image-20210402234129978.png" alt="image-20210402234129978"></p>
<hr>
<p><strong>4.调用MessageBoxA函数</strong></p>
<p>直接修改反汇编为call MessageBoxA即可</p>
<p><img src="/img/loading.gif" data-original="https://610-pic-bed.oss-cn-shenzhen.aliyuncs.com/image-20210402234323243.png" alt="image-20210402234323243"></p>
<hr>
<p><strong>5.调用完后跳转回原本要执行的代码</strong></p>
<p>这里是为了<strong>模拟之后执行完弹窗代码后再跳回程序入口</strong></p>
<p>这里随便模拟一个<strong>长跳转</strong>即可，修改反汇编代码为jmp 000412D0</p>
<p><img src="/img/loading.gif" data-original="https://610-pic-bed.oss-cn-shenzhen.aliyuncs.com/image-20210402234825725.png" alt="image-20210402234825725"></p>
<hr>
<p>6.填充字符串到内存中</p>
<p>下面的代码因为前面的绝对跳转是不会执行的，因此可以用来充当数据区，这也是<strong>要将字符串的填充放在后面的原因</strong></p>
<p>先填充_lpText，也就是”lyl610abc”</p>
<p>选中跳转下的那一行，右键→二进制→编辑</p>
<p><img src="/img/loading.gif" data-original="https://610-pic-bed.oss-cn-shenzhen.aliyuncs.com/image-20210402235240410.png" alt="image-20210402235240410"></p>
<hr>
<p>选中ASCII，并将要写入内存的字符串 “lyl610abc”填入</p>
<p><img src="/img/loading.gif" data-original="https://610-pic-bed.oss-cn-shenzhen.aliyuncs.com/image-20210402235524407.png" alt="image-20210402235524407"></p>
<hr>
<p>填入后再选中Hex那一行，在后面添加00（字符串以’\0’结尾）</p>
<p><img src="/img/loading.gif" data-original="https://610-pic-bed.oss-cn-shenzhen.aliyuncs.com/image-20210403000305968.png" alt="image-20210403000305968"></p>
<hr>
<p>添加完00后得到</p>
<p><img src="/img/loading.gif" data-original="https://610-pic-bed.oss-cn-shenzhen.aliyuncs.com/image-20210403000401936.png" alt="image-20210403000401936"></p>
<p>然后确定即可</p>
<hr>
<p>修改完得到</p>
<p><img src="/img/loading.gif" data-original="https://610-pic-bed.oss-cn-shenzhen.aliyuncs.com/image-20210403000507711.png" alt="image-20210403000507711"></p>
<hr>
<p>这是第三个参数_lpText就可以修正了，将前面的压入第三个参数的反汇编修改为 push 0x00401148</p>
<p><img src="/img/loading.gif" data-original="https://610-pic-bed.oss-cn-shenzhen.aliyuncs.com/image-20210403000803899.png" alt="image-20210403000803899"></p>
<hr>
<p>同样的方法填充第二个参数_lpCaption，也就是”tips”</p>
<p>这里先记录一下其地址为0x00401152，然后开始修改</p>
<p><img src="/img/loading.gif" data-original="https://610-pic-bed.oss-cn-shenzhen.aliyuncs.com/image-20210403001042513.png" alt="image-20210403001042513"></p>
<hr>
<p>修改完后得到：</p>
<p><img src="/img/loading.gif" data-original="https://610-pic-bed.oss-cn-shenzhen.aliyuncs.com/image-20210403001221815.png" alt="image-20210403001221815"></p>
<hr>
<p>最后再修正先前push的用来占位的地址即可</p>
<p><img src="/img/loading.gif" data-original="https://610-pic-bed.oss-cn-shenzhen.aliyuncs.com/image-20210403001315492.png" alt="image-20210403001315492"></p>
<hr>
<p>修改完成，这里记录一下修改的十六进制代码为</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"> 复制代码 隐藏代码6A 00 68 52 11 40 00 68 48 11 40 00 6A 00 E8 A7 F6 94 77 E9 88 01 C4 FF 6C 79 6C 36 31 30 61 62</span><br><span class="line">63 00 74 69 70 73 00</span><br></pre></td></tr></table></figure>

<hr>
<p>修改完成后不断按F8单步步过，直call user32.MessageBoxA这</p>
<p><img src="/img/loading.gif" data-original="https://610-pic-bed.oss-cn-shenzhen.aliyuncs.com/image-20210403001554670.png" alt="image-20210403001554670"></p>
<p>可以看到，对应的参数是没有问题的</p>
<hr>
<p>最后再按F8单步步过即可看到结果：</p>
<p><img src="/img/loading.gif" data-original="https://610-pic-bed.oss-cn-shenzhen.aliyuncs.com/image-20210403001651536.png" alt="image-20210403001651536"></p>
<p>能够按照代码弹框，完成( •̀ ω •́ )✧</p>
<hr>
<h1 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h1><p>限于篇幅原因，这次的笔记主要讲解了<strong>弹窗代码的编写流程</strong>，之后的笔记则是将上面的硬编码稍作修改然后写入PE文件中再修改PE入口点来实现最终目的</p>
<p>终于来到<strong>实战环节</strong>了，前面关于知识点介绍的笔记看的人数一言难尽，希望通过实战能够勾起大家的兴趣，一起学习共同进步O(∩_∩)O</p>
<p>最后再附上 上面OD修改的程序，有兴趣的可以跟着做一做</p>
<p><a target="_blank" rel="noopener" href="https://www.52pojie.cn/forum.php?mod=attachment&aid=MjI1NDQyMHw4N2RlZThiOHwxNjIzNzQyMzE4fDB8MTQwODg2Ng==">MessageBoxA.zip</a></p>
<p>转载自吾爱破解上的一位<a target="_blank" rel="noopener" href="https://www.52pojie.cn/thread-1408866-1-1.html">大佬</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">z1in</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2021/06/15/pe%E6%80%BB%E7%BB%938/">http://example.com/2021/06/15/pe总结8/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://goat2003.github.io/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">z1inのblog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/pe/">pe</a></div><div class="post_share"><div class="social-share" data-image="/images/004.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/loading.gif" data-original="/img/wechat.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/loading.gif" data-original="/img/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li><li class="reward-item"><a href="/img/qq.jpg" target="_blank"><img class="post-qr-code-img" src="/img/loading.gif" data-original="/img/qq.jpg" alt="QQ"/></a><div class="post-qr-code-desc">QQ</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/06/15/pe%E6%80%BB%E7%BB%939/"><img class="prev-cover" src="/img/loading.gif" data-original="/images/004.jpg" onerror="onerror=null;src='/img/404.gif'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">PE文件笔记九 实战之HOOK程序添加弹窗续</div></div></a></div><div class="next-post pull-right"><a href="/2021/06/15/pe%E6%80%BB%E7%BB%937/"><img class="next-cover" src="/img/loading.gif" data-original="/images/004.jpg" onerror="onerror=null;src='/img/404.gif'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">PE文件笔记七 RVA与FOA转换</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/06/15/PE总结4/" title="PE文件笔记四 PE文件头之标准PE头"><img class="cover" src="/img/loading.gif" data-original="/images/004.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-06-15</div><div class="title">PE文件笔记四 PE文件头之标准PE头</div></div></a></div><div><a href="/2021/06/01/pe总结/" title="pe字段总结(持续更新中...)"><img class="cover" src="/img/loading.gif" data-original="/images/004.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-06-01</div><div class="title">pe字段总结(持续更新中...)</div></div></a></div><div><a href="/2021/06/12/pe总结1/" title="PE文件笔记一 PE介绍"><img class="cover" src="/img/loading.gif" data-original="/images/004.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-06-12</div><div class="title">PE文件笔记一 PE介绍</div></div></a></div><div><a href="/2021/06/15/pe总结10/" title="PE文件笔记十 扩大节"><img class="cover" src="/img/loading.gif" data-original="/images/004.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-06-15</div><div class="title">PE文件笔记十 扩大节</div></div></a></div><div><a href="/2021/06/15/pe总结16/" title="PE文件笔记十六 代码重定位"><img class="cover" src="/img/loading.gif" data-original="/images/004.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-06-15</div><div class="title">PE文件笔记十六 代码重定位</div></div></a></div><div><a href="/2021/06/15/pe总结3/" title="PE文件笔记三 DOS部分"><img class="cover" src="/img/loading.gif" data-original="/images/004.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-06-15</div><div class="title">PE文件笔记三 DOS部分</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="/img/loading.gif" data-original="/img/tit.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">z1in</div><div class="author-info__description">一只想成为大佬的小菜鸟</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">36</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">8</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div></div><a class="button--animated" id="card-info-btn" href="/img/alipay.jpg"><i class="iconfont icon-zhifubao"></i><span>鼓励一下我吧</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/xxxxx" target="_blank" title="Github"><i class="iconfont icon-github card_icon"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS链接"><i class="iconfont icon-RSS_flat card_icon"></i></a><a class="social-icon" href="https://blog.csdn.net/goat_2003?spm=1010.2135.3001.5343" target="_blank" title=""><i class="iconfont icon-csdn card_icon"></i></a><a class="social-icon" href="https://wpa.qq.com/msgrd?v=3&amp;uin=1679369498&amp;site=qqq&amp;menu=yes" target="_blank" title=""><i class="iconfont icon-QQ card_icon"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">一只想赚大钱的懒狗</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#PE%E5%AE%9E%E6%88%98%E4%B9%8B%E7%BB%99%E7%A8%8B%E5%BA%8F%E6%B7%BB%E5%8A%A0%E5%BC%B9%E7%AA%97"><span class="toc-number">1.</span> <span class="toc-text">PE实战之给程序添加弹窗</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%B5%81%E7%A8%8B"><span class="toc-number">1.1.</span> <span class="toc-text">修改流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE%E8%A7%A3HOOK%E4%BF%AE%E6%94%B9%E6%B5%81%E7%A8%8B"><span class="toc-number">1.2.</span> <span class="toc-text">图解HOOK修改流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE%E8%A7%A3%E7%BB%99%E7%A8%8B%E5%BA%8F%E6%B7%BB%E5%8A%A0%E5%BC%B9%E7%AA%97"><span class="toc-number">1.3.</span> <span class="toc-text">图解给程序添加弹窗</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%B9%E7%AA%97%E4%BB%A3%E7%A0%81"><span class="toc-number">1.4.</span> <span class="toc-text">弹窗代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C"><span class="toc-number">1.5.</span> <span class="toc-text">运行结果</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MessageBoxA"><span class="toc-number">1.6.</span> <span class="toc-text">MessageBoxA</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%8E%9F%E5%9E%8B"><span class="toc-number">1.6.1.</span> <span class="toc-text">函数原型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0"><span class="toc-number">1.6.2.</span> <span class="toc-text">参数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#uType"><span class="toc-number">1.6.2.1.</span> <span class="toc-text">uType</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="toc-number">1.6.3.</span> <span class="toc-text">返回值</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%8F%8D%E6%B1%87%E7%BC%96"><span class="toc-number">1.7.</span> <span class="toc-text">查看反汇编</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E6%9E%90%E5%8F%8D%E6%B1%87%E7%BC%96"><span class="toc-number">1.8.</span> <span class="toc-text">解析反汇编</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%86%99%E5%8F%8D%E6%B1%87%E7%BC%96%E6%B5%8B%E8%AF%95"><span class="toc-number">1.9.</span> <span class="toc-text">自写反汇编测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E4%BB%A3%E7%A0%81"><span class="toc-number">1.9.1.</span> <span class="toc-text">测试代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C"><span class="toc-number">1.9.2.</span> <span class="toc-text">测试结果</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">1.9.3.</span> <span class="toc-text"></span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E6%B1%87%E7%BC%96%E8%BD%AC%E4%B8%BA%E7%A1%AC%E7%BC%96%E7%A0%81-%E5%AD%97%E8%8A%82%E7%A0%81"><span class="toc-number">1.10.</span> <span class="toc-text">反汇编转为硬编码(字节码)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%8F%8D%E6%B1%87%E7%BC%96%E4%BB%A3%E7%A0%81"><span class="toc-number">1.10.1.</span> <span class="toc-text">修改反汇编代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OD%E6%A8%A1%E6%8B%9F%E4%BB%A3%E7%A0%81%E6%93%8D%E4%BD%9C"><span class="toc-number">1.10.2.</span> <span class="toc-text">OD模拟代码操作</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E"><span class="toc-number">2.</span> <span class="toc-text">说明</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2021/08/13/crackme%20004/" title="160道逆向破解 004"><img src="/img/loading.gif" data-original="/images/009.jpg" onerror="this.onerror=null;this.src='/img/404.gif'" alt="160道逆向破解 004"/></a><div class="content"><a class="title" href="/2021/08/13/crackme%20004/" title="160道逆向破解 004">160道逆向破解 004</a><time datetime="2021-08-13T10:36:23.000Z" title="发表于 2021-08-13 18:36:23">2021-08-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/08/09/160%E9%81%93%E9%80%86%E5%90%91%E7%A0%B4%E8%A7%A3%20002/" title="160道逆向破解 002"><img src="/img/loading.gif" data-original="/images/009.jpg" onerror="this.onerror=null;this.src='/img/404.gif'" alt="160道逆向破解 002"/></a><div class="content"><a class="title" href="/2021/08/09/160%E9%81%93%E9%80%86%E5%90%91%E7%A0%B4%E8%A7%A3%20002/" title="160道逆向破解 002">160道逆向破解 002</a><time datetime="2021-08-09T10:24:23.000Z" title="发表于 2021-08-09 18:24:23">2021-08-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/07/20/%E5%9B%BE%E4%B9%A6%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/" title="期末实训之图书管理系统"><img src="/img/loading.gif" data-original="/images/005.jpg" onerror="this.onerror=null;this.src='/img/404.gif'" alt="期末实训之图书管理系统"/></a><div class="content"><a class="title" href="/2021/07/20/%E5%9B%BE%E4%B9%A6%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/" title="期末实训之图书管理系统">期末实训之图书管理系统</a><time datetime="2021-07-20T05:48:58.000Z" title="发表于 2021-07-20 13:48:58">2021-07-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/06/27/nck%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0%EF%BC%9A%E7%A0%B4%E8%A7%A3%E8%A1%A5%E4%B8%81%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8/" title="nck破解课程02：破解补丁工具的使用"><img src="/img/loading.gif" data-original="/images/009.jpg" onerror="this.onerror=null;this.src='/img/404.gif'" alt="nck破解课程02：破解补丁工具的使用"/></a><div class="content"><a class="title" href="/2021/06/27/nck%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0%EF%BC%9A%E7%A0%B4%E8%A7%A3%E8%A1%A5%E4%B8%81%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8/" title="nck破解课程02：破解补丁工具的使用">nck破解课程02：破解补丁工具的使用</a><time datetime="2021-06-27T09:22:30.000Z" title="发表于 2021-06-27 17:22:30">2021-06-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/06/24/%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E5%B0%8F%E6%9A%B4%E7%A0%B4%20(1)/" title="nck破解课程01：一个最简单的小暴破"><img src="/img/loading.gif" data-original="/images/009.jpg" onerror="this.onerror=null;this.src='/img/404.gif'" alt="nck破解课程01：一个最简单的小暴破"/></a><div class="content"><a class="title" href="/2021/06/24/%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E5%B0%8F%E6%9A%B4%E7%A0%B4%20(1)/" title="nck破解课程01：一个最简单的小暴破">nck破解课程01：一个最简单的小暴破</a><time datetime="2021-06-24T12:04:30.000Z" title="发表于 2021-06-24 20:04:30">2021-06-24</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021  <i id="heartbeat" class="fa fas fa-heartbeat"></i> z1in</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">努力赚大钱</div></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/HCLonely/images@master/others/heartbeat.min.css"></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="rightside.chat_btn"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'h9DnVxAFKDgy6kz4tYbfrMbN-gzGzoHsz',
      appKey: 'ILBSxX9ilJj2Af7ljW8TmPky',
      placeholder: 'Please leave your footprints',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
      requiredFields: ["nick,mail"],
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script>var gitcalendar = new Vue({
  el: '#gitcalendar',
  data: {
    simplemode: true,
    user: 'goat2003',
    fixed: 'fixed',
    px: 'px',
    x: '',
    y: '',
    span1: '',
    span2: '',
    month: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'],
    monthchange: [],
    oneyearbeforeday: '',
    thisday: '',
    amonthago: '',
    aweekago: '',
    weekdatacore: 0,
    datacore: 0,
    total: 0,
    datadate: '',
    data: [],
    positionplusdata: [],
    firstweek: [],
    lastweek: [],
    beforeweek: [],
    thisweekdatacore: 0,
    mounthbeforeday: 0,
    mounthfirstindex: 0,
    crispedges: 'crispedges',
    thisdayindex: 0,
    amonthagoindex: 0,
    amonthagoweek: [],
    firstdate: [],
    first2date: [],
    montharrbefore: [],
    monthindex: 0,
    color: ['#ebedf0', '#fdcdec', '#fc9bd9', '#fa6ac5', '#f838b2', '#f5089f', '#c4067e', '#92055e', '#540336', '#48022f', '#30021f']
  },
  methods: {
    selectStyle(data, event) {
      document.querySelector('.angle-wrapper').style.display = 'block'
      this.span1 = data.date;
      this.span2 = data.count;
      this.x = event.clientX - 100;
      this.y = event.clientY - 60
    },
    outStyle() {
      document.querySelector('.angle-wrapper').style.display = 'none'
    },
    thiscolor(x) {
      if (x === 0) {
        let i = parseInt(x / 2);
        return this.color[0]
      } else if (x < 2) {
        return this.color[1]
      } else if (x < 20) {
        let i = parseInt(x / 2);
        return this.color[i]
      } else {
        return this.color[9]
      }
    },
  }
});
var apiurl = '' ? 'https:///api?' : 'https://githubapi.ryanchristian.dev/user/'
var githubapiurl = apiurl + gitcalendar.user;
//canvas绘图
function responsiveChart() {
  let c = document.getElementById("gitcanvas");
  if (c) {
    let cmessage = document.getElementById("gitmessage");
    let ctx = c.getContext("2d");
    c.width = document.getElementById("gitcalendarcanvasbox").offsetWidth;
    let linemaxwitdh = 0.96 * c.width / gitcalendar.data.length;
    c.height = 9 * linemaxwitdh;
    let lineminwitdh = 0.8 * linemaxwitdh;
    let setposition = {
      x: 0.02 * c.width,
      y: 0.025 * c.width
    };
    for (let week in gitcalendar.data) {
      weekdata = gitcalendar.data[week];
      for (let day in weekdata) {
        let dataitem = {
          date: "",
          count: "",
          x: 0,
          y: 0
        };
        gitcalendar.positionplusdata.push(dataitem);
        ctx.fillStyle = gitcalendar.thiscolor(weekdata[day].count);
        setposition.y = Math.round(setposition.y * 100) / 100;
        dataitem.date = weekdata[day].date;
        dataitem.count = weekdata[day].count;
        dataitem.x = setposition.x;
        dataitem.y = setposition.y;
        ctx.fillRect(setposition.x, setposition.y, lineminwitdh, lineminwitdh);
        setposition.y = setposition.y + linemaxwitdh
      };
      setposition.y = 0.025 * c.width;
      setposition.x = setposition.x + linemaxwitdh
    };
    ctx.font = "600  Arial";
    ctx.fillStyle = '#aaa';
    ctx.fillText("日", 0, 1.9 * linemaxwitdh);
    ctx.fillText("二", 0, 3.9 * linemaxwitdh);
    ctx.fillText("四", 0, 5.9 * linemaxwitdh);
    ctx.fillText("六", 0, 7.9 * linemaxwitdh);
    let monthindexlist = c.width / 24;
    for (let index in gitcalendar.monthchange) {
      ctx.fillText(gitcalendar.monthchange[index], monthindexlist, 0.7 * linemaxwitdh);
      monthindexlist = monthindexlist + c.width / 12
    };
    cmessage.onmousemove = function(event) {
      document.querySelector('.angle-wrapper').style.display = 'none'
    };
    c.onmousemove = function(event) {
      document.querySelector('.angle-wrapper').style.display = 'none'
      getMousePos(c, event);
    };

    function getMousePos(canvas, event) {
      var rect = canvas.getBoundingClientRect();
      var x = event.clientX - rect.left * (canvas.width / rect.width);
      var y = event.clientY - rect.top * (canvas.height / rect.height);
      //console.log("x:"+x+",y:"+y);
      for (let item of gitcalendar.positionplusdata) {
        let lenthx = x - item.x;
        let lenthy = y - item.y;
        //console.log(lenthx,lenthy);
        if (0 < lenthx && lenthx < lineminwitdh) {
          if (0 < lenthy && lenthy < lineminwitdh) {
            //console.log(item.date,item.count)
            document.querySelector('.angle-wrapper').style.display = 'block'
            gitcalendar.span1 = item.date;
            gitcalendar.span2 = item.count;
            gitcalendar.x = event.clientX - 100;
            gitcalendar.y = event.clientY - 60
          }
        }
        //if(0< x - item.x <lineminwitdh&&0< y - item.y <lineminwitdh){
        //console.log(item.count,item.date);
        //}
      }
    }
  }
}
//数据统计算法
function addlastmonth() {
  if (gitcalendar.thisdayindex === 0) {
    thisweekcore(52);
    thisweekcore(51);
    thisweekcore(50);
    thisweekcore(49);
    thisweekcore(48);
    gitcalendar.thisweekdatacore += gitcalendar.firstdate[6].count;
    gitcalendar.amonthago = gitcalendar.firstdate[6].date
  } else {
    thisweekcore(52);
    thisweekcore(51);
    thisweekcore(50);
    thisweekcore(49);
    thisweek2core();
    gitcalendar.amonthago = gitcalendar.first2date[gitcalendar.thisdayindex - 1].date
  }
};

function thisweek2core() {
  for (let i = gitcalendar.thisdayindex - 1; i < gitcalendar.first2date.length; i++) {
    gitcalendar.thisweekdatacore += gitcalendar.first2date[i].count
  }
};

function thisweekcore(index) {
  for (let item of gitcalendar.data[index]) {
    gitcalendar.thisweekdatacore += item.count
  }
};

function addlastweek() {
  for (let item of gitcalendar.lastweek) {
    gitcalendar.weekdatacore += item.count
  }
};

function addbeforeweek() {
  for (let i = gitcalendar.thisdayindex; i < gitcalendar.beforeweek.length; i++) {
    gitcalendar.weekdatacore += gitcalendar.beforeweek[i].count
  }
};

function addweek(data) {
  if (gitcalendar.thisdayindex === 6) {
    gitcalendar.aweekago = gitcalendar.lastweek[0].date;
    addlastweek()
  } else {
    lastweek = data.contributions[51];
    gitcalendar.aweekago = lastweek[gitcalendar.thisdayindex + 1].date;
    addlastweek();
    addbeforeweek()
  }
}

fetch(githubapiurl)
  .then(data => data.json())
  .then(data => {
    gitcalendar.data = data.contributions;
    gitcalendar.total = data.total;
    gitcalendar.first2date = gitcalendar.data[48];
    gitcalendar.firstdate = gitcalendar.data[47];
    gitcalendar.firstweek = data.contributions[0];
    gitcalendar.lastweek = data.contributions[52];
    gitcalendar.beforeweek = data.contributions[51];
    gitcalendar.thisdayindex = gitcalendar.lastweek.length - 1;
    gitcalendar.thisday = gitcalendar.lastweek[gitcalendar.thisdayindex].date;
    gitcalendar.oneyearbeforeday = gitcalendar.firstweek[0].date;
    gitcalendar.monthindex = gitcalendar.thisday.substring(5, 7) * 1;
    gitcalendar.montharrbefore = gitcalendar.month.splice(gitcalendar.monthindex, 12 - gitcalendar.monthindex);
    gitcalendar.monthchange = gitcalendar.montharrbefore.concat(gitcalendar.month);
    addweek(data);
    addlastmonth();
    responsiveChart();
  })
  .catch(function(error) {
    console.log(error);
  });

//手机版更换为svg绘制
if (document.getElementById("gitcalendarcanvasbox").offsetWidth < 500) {
  gitcalendar.simplemode = false
}

//当改变窗口大小时重新绘制canvas
window.onresize = function() {
  if (gitcalendar.simplemode) responsiveChart()
}

//解决滚动滑轮时出现的标签显示
window.onscroll = function() {
  if (document.querySelector('.angle-wrapper')) {
    document.querySelector('.angle-wrapper').style.display = 'none'
  }
};</script><script type="text/javascript" src="/js/fairyDustCursor.js"></script><script type="text/javascript" src="/js/zhedie.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-show-text.min.js" data-mobile="false" data-text="吃饭,睡觉,敲代码,敲代码" data-fontsize="15px" data-random="true" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/Epsilon2.1.model.json"},"display":{"position":"right","width":300,"height":600},"mobile":{"show":true},"log":false});</script><script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(n){n.imageLazyLoadSetting.processImages=o;var e=n.imageLazyLoadSetting.isSPA,i=n.imageLazyLoadSetting.preloadRatio||1,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function o(){e&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(n.innerHeight*i||document.documentElement.clientHeight*i)&&function(){var t,e,n,i,o=r[a];t=o,e=function(){r=r.filter(function(t){return o!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},t.src!==i&&(n.src=i)}()}o(),n.addEventListener("scroll",function(){var t,e;t=o,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this);</script></body></html><script type="text/javascript" src="/js/crash_cheat.js"></script>